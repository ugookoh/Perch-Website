{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport firebase from 'firebase';\nimport React from 'react';\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { BsDot } from 'react-icons/bs';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport { replyFeedback, dateOfQuery, colors } from '../../functions';\nimport styles from '../panel_layout.module.css';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default class UnreadMessages extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"loadResult\", () => {\n      if (this.state.userDetails) {\n        const ref = this.state.riderOrDriver == 'Rider' ? `analytics/unansweredUserFeedbackMessages` : `analytics/unansweredDriverFeedbackMessages`;\n        firebase.database().ref(ref).once('value', snapshot => {\n          this.setState({\n            result: snapshot.val() ? snapshot.val() : {}\n          });\n        });\n      }\n    });\n\n    this.state = {\n      idSearch: '',\n      result: {},\n      userDetails: this.props.userDetails,\n      showMessage: false,\n      response: '',\n      riderOrDriver: 'Rider',\n      toShow: null,\n      showResponse: false,\n      responseDate: 0\n    };\n  }\n\n  componentDidMount() {\n    this.loadResult();\n  }\n\n  loadMessage(path, timestamp, senderID) {\n    const ref = this.state.riderOrDriver == 'Rider' ? `userFeedback/${path}` : `driverFeedback/${path}`;\n    firebase.database().ref(ref).once('value', snapshot => {\n      this.setState({\n        toShow: _objectSpread(_objectSpread({}, snapshot.val()), {}, {\n          timestamp: timestamp,\n          senderID: senderID\n        }),\n        showMessage: true,\n        showResponse: false\n      });\n    });\n  }\n\n  render() {\n    if (!this.state.userDetails && this.props.userDetails) this.setState({\n      userDetails: this.props.userDetails\n    }, () => {\n      this.loadResult();\n    });\n    let results = [];\n    const keys = Object.keys(this.state.result).sort();\n\n    for (let k = 0; k < keys.length; k++) {\n      const path = this.state.result[keys[k]].path;\n      const a = path.indexOf('/') + 1;\n      const b = path.length;\n      const timestamp = Number(path.slice(a, b));\n      const senderID = path.slice(0, a - 1);\n      results.push( /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.previousMessageSum,\n          onClick: () => {\n            this.loadMessage(this.state.result[keys[k]].path, timestamp, senderID);\n          },\n          children: [/*#__PURE__*/_jsx(\"p\", {\n            style: {\n              fontSize: '95%'\n            },\n            children: this.state.result[keys[k]].subject\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.previousMessageDate,\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              style: {\n                fontFamily: 'Gilroy-Semibold',\n                fontSize: '75%',\n                marginRight: '-10px',\n                paddingLeft: '10px'\n              },\n              children: dateOfQuery(timestamp)\n            }), /*#__PURE__*/_jsx(BsDot, {\n              size: '55px',\n              color: colors.GREEN\n            })]\n          })]\n        }), k == keys.length - 1 ? /*#__PURE__*/_jsx(_Fragment, {}) : /*#__PURE__*/_jsx(\"div\", {\n          className: styles.sharedLine,\n          style: {\n            marginTop: '5px'\n          }\n        })]\n      }));\n    }\n\n    return /*#__PURE__*/_jsx(\"div\", {\n      className: styles.cont,\n      children: this.state.showMessage ? /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.container,\n          style: {\n            backgroundColor: colors.WHITE,\n            marginTop: '20px'\n          },\n          children: [/*#__PURE__*/_jsxs(\"p\", {\n            className: styles.title,\n            style: {\n              color: colors.BLACK,\n              marginBottom: '30px'\n            },\n            children: [this.state.toShow.subject, \": \", /*#__PURE__*/_jsxs(\"span\", {\n              style: {\n                fontFamily: 'Gilroy-Light',\n                fontSize: '90%'\n              },\n              children: [\"( Sender ID: \", this.state.toShow.senderID, \" )\"]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.previousMessageC,\n            style: {\n              alignItems: 'flex-start'\n            },\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.previousMessageCol,\n              style: {\n                backgroundColor: 'rgba(145, 134, 134, 0.5)'\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                style: {\n                  fontSize: '95%',\n                  color: colors.BLACK,\n                  lineHeight: '150%',\n                  paddingRight: '10px',\n                  paddingLeft: '10px'\n                },\n                children: this.state.toShow.body\n              })\n            }), /*#__PURE__*/_jsx(\"p\", {\n              style: {\n                fontFamily: 'Gilroy-Semibold',\n                fontSize: '75%'\n              },\n              children: dateOfQuery(this.state.toShow.timestamp)\n            })]\n          }), this.state.showResponse ? /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.previousMessageC,\n            style: {\n              alignItems: 'flex-end'\n            },\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.previousMessageCol,\n              style: {\n                backgroundColor: colors.GREEN\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                style: {\n                  fontSize: '95%',\n                  color: colors.WHITE,\n                  lineHeight: '150%',\n                  paddingRight: '10px',\n                  paddingLeft: '10px'\n                },\n                children: this.state.response\n              })\n            }), /*#__PURE__*/_jsx(\"p\", {\n              style: {\n                fontFamily: 'Gilroy-Semibold',\n                fontSize: '75%'\n              },\n              children: dateOfQuery(this.state.responseDate)\n            })]\n          }) : /*#__PURE__*/_jsxs(_Fragment, {\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.sharedLine\n            }), /*#__PURE__*/_jsx(\"textarea\", {\n              type: \"text\",\n              placeholder: \"Enter your response here\",\n              className: styles.contactUsContent //style={{ width: '100%' }}\n              ,\n              value: this.state.response,\n              onChange: event => {\n                this.setState({\n                  response: event.target.value\n                });\n              }\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.enterKilometerDiv,\n          style: {\n            marginTop: '20px',\n            marginBottom: '150px',\n            marginLeft: '2.5%',\n            width: '95%'\n          },\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: styles.button2,\n            style: {\n              backgroundColor: colors.RED\n            },\n            id: styles.buttonBottom,\n            onClick: () => {\n              this.setState({\n                showMessage: false\n              });\n            },\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.buttonText1,\n              children: \"Cancel\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.button2,\n            style: {\n              backgroundColor: colors.GREEN\n            },\n            id: styles.buttonBottom,\n            onClick: () => {\n              if (this.state.response.length < 10) alert('Please enter a response');else {\n                if (!this.state.showResponse) replyFeedback.call(this, this.state.response, this.state.riderOrDriver, this.state.toShow.senderID, this.state.toShow.timestamp);else alert('Response already sent');\n              }\n            },\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.buttonText1,\n              children: \"Send response\"\n            })\n          })]\n        })]\n      }) : /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.container,\n        style: {\n          backgroundColor: colors.WHITE,\n          marginTop: '20px'\n        },\n        children: [/*#__PURE__*/_jsx(\"p\", {\n          className: styles.title,\n          style: {\n            color: colors.BLACK\n          },\n          children: \"Unread messages\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          style: {\n            width: '90%',\n            display: 'flex',\n            flexDirection: 'row',\n            justifyContent: 'space-between'\n          },\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            style: {\n              width: '90%',\n              height: '10px'\n            }\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.readOrUnreadCont,\n            onClick: () => {\n              this.setState({\n                riderOrDriver: this.state.riderOrDriver == 'Rider' ? 'Driver' : 'Rider'\n              }, () => {\n                this.loadResult();\n              });\n            },\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.readOrUnreadText,\n              children: this.state.riderOrDriver\n            })\n          })]\n        }), results]\n      })\n    });\n  }\n\n}\n;","map":null,"metadata":{},"sourceType":"module"}