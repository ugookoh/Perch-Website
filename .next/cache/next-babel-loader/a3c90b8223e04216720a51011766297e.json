{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport firebase from 'firebase';\nimport React from 'react';\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { AiOutlineCheck } from 'react-icons/ai';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport styles from '../panel_layout.module.css';\nimport { dateOfQuery, colors, driverAppplicationAdvance, validateDriver } from '../../functions';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar DriverApplications = /*#__PURE__*/function (_React$Component) {\n  _inherits(DriverApplications, _React$Component);\n\n  var _super = _createSuper(DriverApplications);\n\n  function DriverApplications(props) {\n    var _this;\n\n    _classCallCheck(this, DriverApplications);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"loadResult\", function () {\n      if (_this.state.userDetails) {\n        firebase.database().ref(\"completedDriverApplications\").once('value', function (snapshot) {\n          _this.setState({\n            result: snapshot.val() ? snapshot.val() : {}\n          });\n        }); // firebase.database().ref(`driverApplications`).once('value', snapshot => {\n        //     this.setState({ result: snapshot.val() ? snapshot.val() : {} })\n        // });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loadDocument\", function (userID, documentStorageID, dateFormat) {\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/driverDetails/driversLicence\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docDriversLicenseURL: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/driverDetails/proofOfWorkEligibility\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docProofOfWorkEligibilityURL: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/driverDetails/epsBackgroundCheck\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docEPSBackgroundCheckURL: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/driverDetails/profilePicture\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docProfilePicture: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/\").concat(documentStorageID, \"/vehicleRegistration\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docRegistrationURL: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/\").concat(documentStorageID, \"/vehicleInsurance\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docInsuranceURL: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/\").concat(documentStorageID, \"/vehicleInspection\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docInspectionURL: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/\").concat(documentStorageID, \"/vehicleImage\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          docVehicleImage: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n      firebase.database().ref(\"vehicles/\".concat(userID, \"/\").concat(dateFormat)).once('value', function (snapshot) {\n        _this.setState({\n          vehicle: snapshot.val()\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loadOfferLeffer\", function (userID) {\n      firebase.storage().ref(\"driverVehicleDocs/\".concat(userID, \"/driverDetails/signedOfferLetter\")).getDownloadURL().then(function (result) {\n        _this.setState({\n          offerLetter: result\n        });\n      })[\"catch\"](function (error) {\n        console.log(error.message);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loadSelectedResult\", function (userID) {\n      firebase.database().ref(\"driverApplications/\".concat(userID)).once('value', function (snapshot) {\n        var _snapshot$val = snapshot.val(),\n            stage = _snapshot$val.stage,\n            timestamp = _snapshot$val.timestamp,\n            name = _snapshot$val.name,\n            vehicleRandomID = _snapshot$val.vehicleRandomID,\n            dateFormat = _snapshot$val.dateFormat,\n            offerLetterSigned = _snapshot$val.offerLetterSigned;\n\n        var verified = JSON.parse(snapshot.val().verified);\n\n        if (stage == 'three') {\n          _this.loadDocument(userID, vehicleRandomID, dateFormat);\n\n          _this.setState({\n            showDocs: true,\n            selected: {\n              name: name,\n              timestamp: timestamp,\n              userID: userID,\n              stage: stage,\n              offerLetterSigned: offerLetterSigned\n            },\n            verified: verified\n          });\n        } else if (stage == 'four') {\n          if (offerLetterSigned) _this.loadOfferLeffer(userID);\n\n          _this.setState({\n            showDocs: true,\n            selected: {\n              name: name,\n              timestamp: timestamp,\n              userID: userID,\n              stage: stage,\n              offerLetterSigned: offerLetterSigned,\n              dateFormat: dateFormat\n            }\n          });\n        }\n      });\n    });\n\n    _this.state = {\n      showDocs: false,\n      result: {},\n      docList: [\"Driver's licence\", \"Proof of work eligibility\", \"EPS background check\", \"Vehicle insurance\", \"Vehicle registration\", \"Vehicle inspection\"],\n      docDriversLicenseURL: false,\n      docProofOfWorkEligibilityURL: false,\n      docEPSBackgroundCheckURL: false,\n      docRegistrationURL: '',\n      docInsuranceURL: '',\n      docInspectionURL: '',\n      docVehicleImage: '',\n      docProfilePicture: '',\n      driversLicenseVerified: false,\n      proofOfWorkEligibilityVerified: false,\n      epsBackgroundCheckVerified: false,\n      inspectionVerified: false,\n      registrationVerified: false,\n      insuranceVerified: false,\n      verified: [],\n      //driversLicenseVerified\n      //proofOfWorkEligibilityVerified\n      //epsBackgroundCheckVerified\n      //insuranceVerified\n      //registrationVerified\n      //inspectionVerified\n      selected: {},\n      vehicle: {},\n      offerLetter: null\n    };\n    return _this;\n  }\n\n  _createClass(DriverApplications, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loadResult();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var requirements = [];\n\n      var _loop = function _loop(i) {\n        var urlToShow = '';\n        if (_this2.state.docList[i] == \"Driver's licence\") urlToShow = _this2.state.docDriversLicenseURL;else if (_this2.state.docList[i] == 'Proof of work eligibility') urlToShow = _this2.state.docProofOfWorkEligibilityURL;else if (_this2.state.docList[i] == 'EPS background check') urlToShow = _this2.state.docEPSBackgroundCheckURL;else if (_this2.state.docList[i] == 'Vehicle insurance') urlToShow = _this2.state.docInsuranceURL;else if (_this2.state.docList[i] == 'Vehicle registration') urlToShow = _this2.state.docRegistrationURL;else if (_this2.state.docList[i] == 'Vehicle inspection') urlToShow = _this2.state.docInspectionURL;\n        var isVerified = _this2.state.verified[i];\n        requirements.push( /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.driverFAQ_PICDESC,\n          id: styles.driverROUNDSUPPORT,\n          children: [/*#__PURE__*/_jsx(\"a\", {\n            href: urlToShow,\n            target: '_blank',\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.text,\n              style: {\n                color: '#000000',\n                width: 'initial',\n                margin: '0px',\n                marginLeft: '10px'\n              },\n              children: _this2.state.docList[i]\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.driver_APP_RADIO,\n            style: {\n              backgroundColor: colors.GREEN,\n              opacity: isVerified ? 1 : 0.5\n            },\n            onClick: function onClick() {\n              var verified = _this2.state.verified;\n              verified[i] = true;\n\n              _this2.setState({\n                verified: verified\n              }, function () {\n                firebase.database().ref(\"driverApplications/\".concat(_this2.state.selected.userID)).update({\n                  verified: JSON.stringify(verified)\n                });\n              });\n            },\n            children: isVerified ? /*#__PURE__*/_jsx(AiOutlineCheck, {\n              color: colors.WHITE,\n              size: '15px'\n            }) : /*#__PURE__*/_jsx(_Fragment, {})\n          })]\n        }));\n      };\n\n      for (var i = 0; i < this.state.docList.length; i++) {\n        _loop(i);\n      }\n\n      if (!this.state.userDetails && this.props.userDetails) this.setState({\n        userDetails: this.props.userDetails\n      }, function () {\n        _this2.loadResult();\n      });\n      var results = [];\n      var keys = Object.keys(this.state.result).sort(function (a, b) {\n        var stageA = 0,\n            stageB = 0;\n\n        switch (_this2.state.result[a].stage) {\n          case 'one':\n            {\n              stageA = 1;\n            }\n            break;\n\n          case 'two':\n            {\n              stageA = 2;\n            }\n            break;\n\n          case 'three':\n            {\n              stageA = 3;\n            }\n            break;\n\n          case 'four':\n            {\n              stageA = 4;\n            }\n            break;\n        }\n\n        ;\n\n        switch (_this2.state.result[b].stage) {\n          case 'one':\n            {\n              stageB = 1;\n            }\n            break;\n\n          case 'two':\n            {\n              stageB = 2;\n            }\n            break;\n\n          case 'three':\n            {\n              stageB = 3;\n            }\n            break;\n\n          case 'four':\n            {\n              stageB = 4;\n            }\n            break;\n        }\n\n        ;\n        if (stageB == 4 && _this2.state.result[b].offerLetterSigned == false) //so that drivers that havent signed offer letters stay below\n          return stageA - stageB;else return stageB - stageA;\n      });\n\n      var _loop2 = function _loop2(k) {\n        var userID = keys[k];\n        var _this2$state$result$k = _this2.state.result[keys[k]],\n            stage = _this2$state$result$k.stage,\n            timestamp = _this2$state$result$k.timestamp,\n            name = _this2$state$result$k.name;\n        var stageToDisplay = 0;\n        var color = colors.YELLOW;\n\n        switch (stage) {\n          case 'one':\n            {\n              stageToDisplay = \"S1\";\n            }\n            break;\n\n          case 'two':\n            {\n              stageToDisplay = \"S2\";\n            }\n            break;\n\n          case 'three':\n            {\n              stageToDisplay = \"S3\";\n              color = colors.GREEN;\n            }\n            break;\n\n          case 'four':\n            {\n              stageToDisplay = \"S4\";\n              color = colors.GREEN;\n            }\n            break;\n        }\n\n        ;\n        results.push( /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: styles.previousMessageSum,\n            onClick: function onClick() {\n              _this2.loadSelectedResult(userID);\n            },\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              style: {\n                fontSize: '95%'\n              },\n              children: name\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                display: 'flex',\n                flexDirection: 'row',\n                width: '150px',\n                justifyContent: 'space-between'\n              },\n              children: /*#__PURE__*/_jsxs(\"span\", {\n                style: {\n                  flexDirection: 'row',\n                  display: 'flex',\n                  alignItems: 'center'\n                },\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.previousMessageDate,\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    style: {\n                      fontFamily: 'Gilroy-Semibold',\n                      fontSize: '75%',\n                      marginRight: '-10px',\n                      paddingLeft: '10px'\n                    },\n                    children: dateOfQuery(timestamp)\n                  })\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    width: '50px',\n                    height: '30px',\n                    backgroundColor: color,\n                    borderRadius: '5px',\n                    display: 'flex',\n                    justifyContent: 'center',\n                    alignItems: 'center'\n                  },\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    className: styles.readOrUnreadText,\n                    style: {\n                      color: '#ffffff',\n                      fontFamily: 'Gilroy-ExtraBold'\n                    },\n                    children: stageToDisplay\n                  })\n                })]\n              })\n            })]\n          }), k == keys.length - 1 ? /*#__PURE__*/_jsx(_Fragment, {}) : /*#__PURE__*/_jsx(\"div\", {\n            className: styles.sharedLine,\n            style: {\n              marginTop: '5px'\n            }\n          })]\n        }));\n      };\n\n      for (var k = 0; k < keys.length; k++) {\n        _loop2(k);\n      }\n\n      return /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.cont,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.container,\n          style: {\n            backgroundColor: colors.WHITE,\n            marginTop: '20px'\n          },\n          children: [/*#__PURE__*/_jsx(\"p\", {\n            className: styles.title,\n            style: {\n              color: colors.BLACK,\n              marginBottom: '20px'\n            },\n            children: this.state.showDocs ? this.state.selected.name : 'Driver Applications'\n          }), this.state.selected.stage == 'three' ? /*#__PURE__*/_jsx(\"p\", {\n            className: styles.title,\n            style: {\n              color: colors.BLACK,\n              marginTop: '-10px'\n            },\n            children: this.state.showDocs ? /*#__PURE__*/_jsxs(_Fragment, {\n              children: [this.state.vehicle.year, \" \", this.state.vehicle.color, \" \", this.state.vehicle.model, \" \", this.state.vehicle.make, \" - (\", /*#__PURE__*/_jsx(\"span\", {\n                style: {\n                  color: colors.GREEN\n                },\n                children: this.state.vehicle.plateNumber\n              }), \")\"]\n            }) : ''\n          }) : this.state.selected.stage == 'four' ? /*#__PURE__*/_jsx(\"p\", {\n            className: styles.title,\n            style: {\n              color: colors.BLACK,\n              marginTop: '-10px'\n            },\n            children: \"User ID - \".concat(this.state.selected.userID)\n          }) : /*#__PURE__*/_jsx(_Fragment, {}), this.state.showDocs ? this.state.selected.stage == 'three' ? /*#__PURE__*/_jsxs(_Fragment, {\n            children: [/*#__PURE__*/_jsx(\"img\", {\n              src: this.state.docProfilePicture,\n              className: styles.driverVehicleIMAGE,\n              style: {\n                maxWidth: '250px',\n                marginTop: '20px'\n              }\n            }), requirements, /*#__PURE__*/_jsx(\"img\", {\n              src: this.state.docVehicleImage,\n              className: styles.driverVehicleIMAGE\n            })]\n          }) :\n          /*#__PURE__*/\n          //STAGE FOUR\n          _jsx(_Fragment, {\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: styles.driverFAQ_PICDESC,\n              id: styles.driverROUNDSUPPORT,\n              children: [/*#__PURE__*/_jsx(\"a\", {\n                href: this.state.offerLetter,\n                target: '_blank',\n                children: /*#__PURE__*/_jsx(\"p\", {\n                  className: styles.text,\n                  style: {\n                    color: '#000000',\n                    width: 'initial',\n                    margin: '0px',\n                    marginLeft: '10px'\n                  },\n                  children: 'Perch Offer Letter'\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: styles.driver_APP_RADIO,\n                style: {\n                  backgroundColor: colors.GREEN,\n                  opacity: this.state.selected.offerLetterSigned ? 1 : 0.6\n                },\n                children: this.state.selected.offerLetterSigned ? /*#__PURE__*/_jsx(AiOutlineCheck, {\n                  color: colors.WHITE,\n                  size: '15px'\n                }) : /*#__PURE__*/_jsx(_Fragment, {})\n              })]\n            })\n          }) : results]\n        }), this.state.showDocs ? /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.enterKilometerDiv,\n          style: {\n            marginTop: '20px',\n            marginBottom: '150px',\n            marginLeft: '2.5%',\n            width: '95%'\n          },\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: styles.button2,\n            style: {\n              backgroundColor: colors.RED\n            },\n            id: styles.buttonBottom,\n            onClick: function onClick() {\n              _this2.setState({\n                showDocs: false,\n                vehicle: {},\n                verified: []\n              });\n            },\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.buttonText1,\n              children: \"Cancel\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.button2,\n            style: {\n              backgroundColor: colors.GREEN\n            },\n            id: styles.buttonBottom,\n            onClick: function onClick() {\n              if (_this2.state.selected.stage == 'three') {\n                if (_this2.state.verified.indexOf(false) != -1) alert('You need to verify all the provided documents');else {\n                  driverAppplicationAdvance.call(_this2);\n                }\n              } else if (_this2.state.selected.stage == 'four') {\n                if (_this2.state.selected.offerLetterSigned) {\n                  var _this2$state$selected = _this2.state.selected,\n                      userID = _this2$state$selected.userID,\n                      timestamp = _this2$state$selected.timestamp,\n                      dateFormat = _this2$state$selected.dateFormat;\n                  validateDriver.call(_this2, userID, timestamp, dateFormat);\n                } else alert('Driver has not yet signed offer letter, please send them a reminder if it has been a while');\n              }\n            },\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.buttonText1,\n              children: this.state.selected.stage == 'three' ? 'Send offer letter' : 'Validate Driver'\n            })\n          })]\n        }) : /*#__PURE__*/_jsx(_Fragment, {})]\n      });\n    }\n  }]);\n\n  return DriverApplications;\n}(React.Component);\n\nexport { DriverApplications as default };\n;","map":null,"metadata":{},"sourceType":"module"}