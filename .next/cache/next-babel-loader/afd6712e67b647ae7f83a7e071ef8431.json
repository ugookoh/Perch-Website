{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState } from 'react';\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { AiOutlineClose, AiOutlineRight } from 'react-icons/ai';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport { colors, storeCard, deleteCard, buyKilometers } from '../../functions';\nimport styles from '../panel_layout.module.css';\nimport firebase from 'firebase';\nimport { loadStripe } from '@stripe/stripe-js';\nimport axios from 'axios';\nimport Loader from 'react-loader-spinner';\nimport { CardElement, Elements, useElements, useStripe } from '@stripe/react-stripe-js';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nconst stripePromise = loadStripe('pk_test_RjADdW2vGwFAgOOk7ws1juNB002JV727O8');\nexport default class PerchWallet extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"loadCards\", () => {\n      const {\n        userID\n      } = this.state.userDetails;\n      firebase.database().ref(`cards/${userID}`).once('value', snapshot => {\n        if (!!snapshot) {\n          let arrayOfLast4 = [],\n              i = 0;\n\n          for (let key in snapshot.val()) {\n            if (key != 'selected') arrayOfLast4[i] = {\n              last4: snapshot.val()[key].card.last4,\n              brand: snapshot.val()[key].card.brand,\n              cardId: snapshot.val()[key].card.cardId\n            };else if (key == 'selected') this.setState({\n              selected: snapshot.val()[key]\n            });\n            i++;\n          }\n\n          this.setState({\n            cards: arrayOfLast4\n          });\n        }\n\n        ;\n      });\n    });\n\n    _defineProperty(this, \"setSelected\", value => {\n      const {\n        userID\n      } = this.state.userDetails;\n      firebase.database().ref(`cards/${userID}`).update({\n        selected: value\n      }).then(() => {\n        this.setState({\n          selected: value\n        });\n      }).catch(error => {\n        this.setState({\n          errorMessage: error.message\n        });\n      });\n    });\n\n    _defineProperty(this, \"removeCard\", index => {\n      let {\n        cards\n      } = this.state;\n      cards.splice(index, 1);\n      this.setState({\n        cards: cards\n      });\n    });\n\n    this.state = {\n      buyKilometers: false,\n      addCard: false,\n      userDetails: this.props.userDetails,\n      quantity: 0,\n      cards: [],\n      selected: null,\n      index: 0,\n      name: '',\n      cardNumber: '',\n      expiryDate: '',\n      ccv: '',\n      errorMessage: '',\n      loading: false,\n      rate: 0,\n      kms: '',\n      cost: 0,\n      paymentLoading: false\n    };\n  }\n\n  componentDidMount() {\n    const {\n      userID\n    } = this.state.userDetails;\n    firebase.database().ref(`perchKilometers/${userID}/quantity`).on('value', snapshot => {\n      if (!!snapshot) this.setState({\n        quantity: snapshot.val()\n      });\n    });\n    firebase.database().ref(`costPerPerchKM`).on('value', snapshot => {\n      this.setState({\n        rate: snapshot.val()\n      });\n    });\n    this.loadCards();\n  }\n\n  render() {\n    var _this$state$rate, _this$state$cost;\n\n    let cards = [];\n\n    for (let i = 0; i < this.state.cards.length; i++) cards.push( /*#__PURE__*/_jsx(PaymentCard, {\n      userID: this.state.userDetails.userID,\n      card: this.state.cards[i],\n      index: i,\n      removeCard: this.removeCard,\n      setSelected: this.setSelected,\n      selectedCard: this.state.selected,\n      selected: this.state.selected === this.state.cards[i].last4,\n      type: this.state.buyKilometers ? 'pickPayment' : 'listOfCards'\n    }, this.state.cards[i].last4));\n\n    return /*#__PURE__*/_jsx(Elements, {\n      stripe: stripePromise,\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: styles.cont,\n        children: this.state.buyKilometers ? //buy kilometers\n        this.state.paymentLoading ? /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(ProcessPayment, {\n            goBack: () => {\n              this.setState({\n                buyKilometers: false,\n                addCard: false,\n                kms: '',\n                errorMessage: '',\n                paymentLoading: false\n              });\n            },\n            toSend: {\n              cardId: this.state.cards[this.state.index].cardId,\n              customerID: this.state.userDetails.stripeCustomerID,\n              quantity: Number(this.state.kms),\n              userID: this.state.userDetails.userID,\n              timestamp: new Date().getTime(),\n              isAutomatic: true\n            }\n          })\n        }) : /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: styles.container,\n            style: {\n              backgroundColor: colors.WHITE,\n              marginTop: '20px'\n            },\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: styles.title,\n              style: {\n                color: colors.BLACK\n              },\n              children: \"Enter the amount of kilometers you would like to purchase\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              placeholder: \"Enter amount of kilometers\",\n              value: this.state.kms,\n              onChange: e => {\n                const value = e.target.value;\n\n                if (value.length <= 3) {\n                  const cost = Number(value) * this.state.rate;\n                  this.setState({\n                    kms: value,\n                    cost: cost\n                  });\n                }\n              },\n              className: styles.inputPaymentPanel\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: styles.enterKilometerDiv,\n              style: {\n                marginTop: '20px'\n              },\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                style: {\n                  width: 'initial',\n                  margin: '0px',\n                  fontFamily: 'Gilroy-Medium',\n                  color: colors.GREY\n                },\n                className: styles.text,\n                children: \"Cost per kilometer\"\n              }), /*#__PURE__*/_jsx(\"p\", {\n                style: {\n                  width: 'initial',\n                  margin: '0px',\n                  fontFamily: 'Gilroy-Medium'\n                },\n                className: styles.text,\n                children: `$ ${(_this$state$rate = this.state.rate) === null || _this$state$rate === void 0 ? void 0 : _this$state$rate.toFixed(2)}`\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.sharedLine,\n              style: {\n                marginTop: '20px',\n                width: '90%'\n              }\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: styles.enterKilometerDiv,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                style: {\n                  width: 'initial',\n                  margin: '0px',\n                  fontFamily: 'Gilroy-Bold',\n                  fontSize: '120%'\n                },\n                className: styles.text,\n                children: \"Total\"\n              }), /*#__PURE__*/_jsx(\"p\", {\n                style: {\n                  width: 'initial',\n                  margin: '0px',\n                  fontFamily: 'Gilroy-Bold',\n                  color: colors.GREEN,\n                  fontSize: '120%'\n                },\n                className: styles.text,\n                children: `$ ${(_this$state$cost = this.state.cost) === null || _this$state$cost === void 0 ? void 0 : _this$state$cost.toFixed(2)}`\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.container,\n            style: {\n              backgroundColor: colors.WHITE,\n              marginTop: '20px'\n            },\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: styles.title,\n              style: {\n                color: colors.BLACK\n              },\n              children: \"Payment Methods\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: styles.text,\n              style: {\n                color: colors.GREY,\n                marginBottom: '20px'\n              },\n              children: \"List of available payment methods. New payment methods can also be added.\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.paymentCont,\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.paymentItem,\n                children: [cards, /*#__PURE__*/_jsxs(\"div\", {\n                  className: styles.paymentRow,\n                  id: styles.addCardPayment,\n                  onClick: () => {\n                    this.setState({\n                      addCard: true,\n                      buyKilometers: false,\n                      errorMessage: ''\n                    });\n                  },\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    style: {\n                      flexDirection: 'row',\n                      display: 'flex',\n                      alignItems: 'center'\n                    },\n                    children: [/*#__PURE__*/_jsx(\"img\", {\n                      src: \"/addPaymentCardIcon.svg\",\n                      alt: \"Perch Payment\",\n                      className: styles.visaIcon,\n                      style: {\n                        marginRight: '15px'\n                      }\n                    }), /*#__PURE__*/_jsx(\"p\", {\n                      className: styles.paymentCardNumber,\n                      id: styles.paymentCardNumber_,\n                      children: \"Add Debit / Credit Card\"\n                    })]\n                  }), /*#__PURE__*/_jsx(AiOutlineRight, {\n                    color: colors.BLACK\n                  })]\n                })]\n              })\n            }), this.state.errorMessage && /*#__PURE__*/_jsx(\"p\", {\n              className: styles.em,\n              style: {\n                textAlign: 'initial'\n              },\n              children: this.state.errorMessage\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.enterKilometerDiv,\n            style: {\n              marginTop: '20px',\n              marginBottom: '150px',\n              marginLeft: '2.5%',\n              width: '95%'\n            },\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.button2,\n              style: {\n                backgroundColor: colors.RED\n              },\n              id: styles.buttonBottom,\n              onClick: () => {\n                this.setState({\n                  buyKilometers: false,\n                  addCard: false,\n                  errorMessage: ''\n                });\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: styles.buttonText1,\n                children: \"Cancel\"\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              onClick: () => {\n                if (this.state.kms < 20) this.setState({\n                  errorMessage: 'You can get a minimum of 20 kilometers'\n                });else if (this.state.kms > 100) this.setState({\n                  errorMessage: 'You can get a maximum of 100 kilometers'\n                });else if (this.state.selected) {\n                  for (let i = 0; i < this.state.cards.length; i++) if (this.state.selected === this.state.cards[i].last4) this.setState({\n                    index: i,\n                    paymentLoading: true\n                  }); // buyKilometers.call(this, {\n                  //     cardId: this.state.cards[i].cardId,\n                  //     customerID: this.state.userDetails.stripeCustomerID,\n                  //     quantity: Number(this.state.kms),\n                  //     userID: this.state.userDetails.userID,\n                  //     timestamp: new Date().getTime(),\n                  // })\n\n                } else this.setState({\n                  errorMessage: 'Please select or add a payment method'\n                });\n              },\n              className: styles.button2,\n              style: {\n                backgroundColor: colors.GREEN\n              },\n              id: styles.buttonBottom,\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: styles.buttonText1,\n                children: \"Buy Kilometers\"\n              })\n            })]\n          })]\n        }) : this.state.addCard ?\n        /*#__PURE__*/\n        //add card\n        _jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(AddCardForm, {\n            userID: this.state.userDetails.userID,\n            cancel: () => {\n              this.loadCards();\n              this.setState({\n                errorMessage: '',\n                addCard: false,\n                buyKilometers: false\n              });\n            }\n          })\n        }) :\n        /*#__PURE__*/\n        //main page\n        _jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: styles.container,\n            style: {\n              backgroundColor: colors.WHITE,\n              marginTop: '20px'\n            },\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: styles.title,\n              style: {\n                color: colors.BLACK\n              },\n              children: \"Kilometers\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: styles.text,\n              style: {\n                color: colors.GREY\n              },\n              children: \"You can make kilometer purchases from this panel. Also remember that sharing your code with friends who book their first ride automatically gives you free kilometers.\"\n            }), /*#__PURE__*/_jsx(\"img\", {\n              src: \"/walletImage.svg\",\n              alt: \"Purchase Perch Kilometers\",\n              className: styles.walletImage\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: styles.title,\n              style: {\n                width: 'initial',\n                marginTop: '20px'\n              },\n              children: `${this.state.quantity.toFixed(1)} kilometers`\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.button1,\n              style: {},\n              onClick: () => {\n                this.setState({\n                  buyKilometers: true,\n                  addCard: false,\n                  errorMessage: ''\n                });\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: styles.buttonText1,\n                children: \"Buy kilometers\"\n              })\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.container,\n            style: {\n              backgroundColor: colors.WHITE,\n              marginTop: '20px',\n              marginBottom: '150px'\n            },\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: styles.title,\n              style: {\n                color: colors.BLACK\n              },\n              children: \"Payment Methods\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: styles.text,\n              style: {\n                color: colors.GREY,\n                marginBottom: '20px'\n              },\n              children: \"List of available payment methods. New payment methods can also be added.\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.paymentCont,\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.paymentItem,\n                children: [cards, /*#__PURE__*/_jsxs(\"div\", {\n                  className: styles.paymentRow,\n                  id: styles.addCardPayment,\n                  onClick: () => {\n                    this.setState({\n                      addCard: true,\n                      buyKilometers: false,\n                      errorMessage: ''\n                    });\n                  },\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    style: {\n                      flexDirection: 'row',\n                      display: 'flex',\n                      alignItems: 'center'\n                    },\n                    children: [/*#__PURE__*/_jsx(\"img\", {\n                      src: \"/addPaymentCardIcon.svg\",\n                      alt: \"Perch Payment\",\n                      className: styles.visaIcon,\n                      style: {\n                        marginRight: '15px'\n                      }\n                    }), /*#__PURE__*/_jsx(\"p\", {\n                      className: styles.paymentCardNumber,\n                      id: styles.paymentCardNumber_,\n                      children: \"Add Debit / Credit Card\"\n                    })]\n                  }), /*#__PURE__*/_jsx(AiOutlineRight, {\n                    color: colors.BLACK\n                  })]\n                })]\n              })\n            })]\n          })]\n        })\n      })\n    });\n  }\n\n}\n;\n\nclass PaymentCard extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      deleteCard: false,\n      loading: false\n    };\n  }\n\n  render() {\n    const {\n      selected,\n      setSelected,\n      card,\n      userID,\n      removeCard,\n      index,\n      selectedCard\n    } = this.props;\n    const {\n      last4,\n      brand\n    } = card;\n    if (this.props.type == 'listOfCards') return /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: styles.paymentRow,\n        id: styles.paymentRow_,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          style: {\n            flexDirection: 'row',\n            display: 'flex',\n            alignItems: 'center'\n          },\n          children: [/*#__PURE__*/_jsx(\"img\", {\n            src: brand == 'Visa' ? \"/visaIcon.svg\" : brand == 'Mastercard' ? '/mastercardIcon.svg' : '/addPaymentCardIcon.svg',\n            alt: \"Perch Payment\",\n            className: brand == 'Visa' ? styles.visaIcon : brand == 'Mastercard' ? styles.masterCardIcon : styles.genericCard\n          }), /*#__PURE__*/_jsxs(\"p\", {\n            className: styles.paymentCardNumber,\n            id: styles.paymentCardNumber_,\n            children: [\"XXXX XXXX XXXX \", last4]\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          id: styles.paymentRowButton,\n          children: this.state.deleteCard ? /*#__PURE__*/_jsxs(_Fragment, {\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.button2,\n              style: {\n                backgroundColor: colors.RED,\n                width: '80%'\n              },\n              onClick: () => {\n                deleteCard.call(this, userID, last4, selectedCard);\n                removeCard(index);\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: styles.buttonText1,\n                id: styles.paymentCardNumber_,\n                children: \"Delete this card?\"\n              })\n            }), /*#__PURE__*/_jsx(AiOutlineClose, {\n              className: styles.closeDeletePayment,\n              onClick: () => {\n                this.setState({\n                  deleteCard: false\n                });\n              }\n            })]\n          }) : /*#__PURE__*/_jsxs(_Fragment, {\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: selected ? styles.buttonSelected : styles.button2,\n              style: {\n                backgroundColor: colors.GREEN\n              },\n              onClick: () => {\n                setSelected(last4);\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: styles.buttonText1,\n                id: styles.paymentCardNumber_,\n                children: selected ? 'Selected' : 'Select card'\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.button2,\n              style: {\n                backgroundColor: colors.RED\n              },\n              onClick: () => {\n                this.setState({\n                  deleteCard: true\n                });\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: styles.buttonText1,\n                id: styles.paymentCardNumber_,\n                children: \"Delete Card\"\n              })\n            })]\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.sharedLine,\n        style: {\n          marginTop: '20px',\n          width: '100%'\n        }\n      })]\n    });else if (this.props.type == 'pickPayment') return (\n      /*#__PURE__*/\n      //TO MAKE A SELECTED ONE, THE PARENT COMPONENT SHOULD HAVE A SELECTED ITEM ID AND WE COMPARE ID HERE TO SHOW IF IT IS CONFIRMED OR NOT\n      _jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.paymentRow,\n          id: styles.addCardPayment_,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            style: {\n              flexDirection: 'row',\n              display: 'flex',\n              alignItems: 'center'\n            },\n            children: [/*#__PURE__*/_jsx(\"img\", {\n              src: brand == 'Visa' ? \"/visaIcon.svg\" : brand == 'Mastercard' ? '/mastercardIcon.svg' : '/addPaymentCardIcon.svg',\n              alt: \"Perch Payment\",\n              className: brand == 'Visa' ? styles.visaIcon : brand == 'Mastercard' ? styles.masterCardIcon : styles.genericCard\n            }), /*#__PURE__*/_jsxs(\"p\", {\n              className: styles.paymentCardNumber,\n              id: styles.paymentCardNumber_,\n              children: [\"\\u2022\\u2022\\u2022\\u2022 \", last4]\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.pickPaymentSelected,\n            id: selected ? styles.selectedID : styles.selectID,\n            style: {\n              backgroundColor: colors.GREEN\n            },\n            onClick: () => {\n              setSelected(last4);\n            },\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: styles.buttonText1,\n              id: styles.paymentCardNumber_,\n              children: selected ? 'Selected' : 'Select'\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.sharedLine,\n          style: {\n            marginTop: '0px',\n            width: '100%'\n          }\n        })]\n      })\n    );\n  }\n\n}\n\n;\n\nconst AddCardForm = ({\n  cancel,\n  userID\n}) => {\n  const {\n    0: name,\n    1: setName\n  } = useState('');\n  const {\n    0: errorMessage,\n    1: setErrorMessage\n  } = useState('');\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const createTokenWithCard = async () => {\n    setLoading(true);\n\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return;\n    }\n\n    ; // Get a reference to a mounted CardElement. Elements knows how\n    // to find your CardElement because there can only ever be one of\n    // each type of element.\n\n    const cardElement = elements.getElement(CardElement); // Use your card Element with other Stripe.js APIs\n\n    const {\n      error,\n      token\n    } = await stripe.createToken(cardElement);\n\n    if (error) {\n      setErrorMessage(error.message);\n      setLoading(false);\n    } else {\n      storeCard.call(this, userID, token, setLoading, setErrorMessage, cancel);\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: styles.container,\n      style: {\n        backgroundColor: colors.WHITE,\n        marginTop: '20px'\n      },\n      children: [/*#__PURE__*/_jsx(\"p\", {\n        className: styles.title,\n        style: {\n          color: colors.BLACK\n        },\n        children: \"Add card\"\n      }), /*#__PURE__*/_jsx(\"input\", {\n        type: \"text\",\n        placeholder: \"Name on Card\",\n        className: styles.inputPaymentPanel,\n        id: styles.inputPaymentPanel_ADD,\n        style: {\n          marginTop: '10px'\n        },\n        value: name,\n        onChange: e => {\n          const value = e.target.value;\n          setName(value);\n        }\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.inputPaymentPanel,\n        children: /*#__PURE__*/_jsx(CardElement, {\n          options: {\n            hidePostalCode: true,\n            style: {\n              base: {\n                color: '#303238',\n                fontSize: '16px',\n                fontFamily: '\"Gill Sans\", sans-serif',\n                fontSmoothing: 'antialiased',\n                '::placeholder': {\n                  color: '#757575'\n                }\n              },\n              invalid: {\n                color: '#e5424d',\n                ':focus': {\n                  color: '#303238'\n                }\n              }\n            }\n          }\n        })\n      }), errorMessage && /*#__PURE__*/_jsx(\"p\", {\n        className: styles.em,\n        style: {\n          textAlign: 'initial'\n        },\n        children: errorMessage\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.enterKilometerDiv,\n      style: {\n        marginTop: '20px',\n        marginBottom: '150px',\n        marginLeft: '2.5%',\n        width: '95%'\n      },\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: styles.button2,\n        style: {\n          backgroundColor: colors.RED\n        },\n        id: styles.buttonBottom,\n        onClick: cancel,\n        children: /*#__PURE__*/_jsx(\"p\", {\n          className: styles.buttonText1,\n          children: \"Cancel\"\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.button2,\n        style: {\n          backgroundColor: colors.GREEN\n        },\n        id: styles.buttonBottom,\n        onClick: () => {\n          if (name.length <= 3) setErrorMessage('Please enter the full name on the card');else createTokenWithCard();\n        },\n        children: loading ? /*#__PURE__*/_jsx(Loader, {\n          type: \"TailSpin\",\n          color: colors.WHITE,\n          height: '20px',\n          width: '20px'\n        }) : /*#__PURE__*/_jsx(\"p\", {\n          className: styles.buttonText1,\n          children: \"Add Card\"\n        })\n      })]\n    })]\n  });\n};\n\nconst ProcessPayment = ({\n  goBack,\n  toSend\n}) => {\n  const {\n    0: paymentError,\n    1: setPaymentError\n  } = useState(false);\n  const {\n    0: paymentCompleted,\n    1: setPaymentCompleted\n  } = useState(false);\n  const {\n    0: paymentErrorMessage,\n    1: setPaymentErrorMessage\n  } = useState('');\n  const stripe = useStripe(); //const elements = useElements();\n\n  const startPayment = async () => {\n    if (!stripe) return;\n    axios.post(`https://us-central1-perch-01.cloudfunctions.net/buyPerchKilometers`, _objectSpread(_objectSpread({}, toSend), {}, {\n      status: 'initial'\n    })).then(result => {\n      const {\n        status,\n        client_secret,\n        id\n      } = result.data;\n      toSend.paymentIntentId = id;\n      toSend.status = 'confirm_payment';\n\n      if (status == 'succeeded') {\n        setPaymentCompleted(true);\n      } else if (status == 'requires_action') {\n        stripe.confirmCardPayment(client_secret).then(data => {\n          if (data.paymentIntent.status == 'succeeded') {\n            axios.post(`https://us-central1-perch-01.cloudfunctions.net/buyPerchKilometers`, _objectSpread(_objectSpread({}, toSend), {}, {\n              nativePayType: 'Debit/Credit Card from website',\n              paymentIntentId: id,\n              status: 'payment_completed_on_client'\n            })).then(() => {\n              setPaymentCompleted(true);\n            }).catch(error => {\n              setPaymentError(true);\n              setPaymentErrorMessage(error.message);\n            });\n          }\n        }).catch(error => {\n          setPaymentError(true);\n          setPaymentErrorMessage(error.message);\n        });\n      }\n    }).catch(error => {\n      setPaymentError(true);\n      setPaymentErrorMessage(error.message);\n    });\n  };\n\n  useEffect(() => {\n    startPayment();\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.container,\n    style: {\n      backgroundColor: colors.WHITE,\n      marginTop: '20px'\n    },\n    children: [!paymentCompleted && !paymentError && /*#__PURE__*/_jsx(Loader, {\n      type: \"TailSpin\",\n      color: colors.GREEN,\n      height: '100px',\n      width: '100px',\n      style: {\n        marginTop: 25\n      }\n    }), /*#__PURE__*/_jsx(\"p\", {\n      className: styles.title,\n      style: {\n        color: colors.GREY,\n        width: 'initial',\n        marginTop: 20,\n        marginBottom: 30,\n        paddingRight: 15,\n        paddingLeft: 15,\n        textAlign: 'center'\n      },\n      children: paymentCompleted ? `Your payment has been processed. Thank you.` : paymentError ? `Your payment failed. Please contact your bank or try again later` : `Your payment is currently processing. Please wait.`\n    }), (paymentCompleted || paymentError) && /*#__PURE__*/_jsx(\"div\", {\n      className: styles.button1,\n      style: {\n        marginTop: 0\n      },\n      onClick: goBack,\n      children: /*#__PURE__*/_jsx(\"p\", {\n        className: styles.buttonText1,\n        children: \"Go back\"\n      })\n    })]\n  });\n};","map":null,"metadata":{},"sourceType":"module"}